<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Contract Review - Professional Legal Analysis</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #3498db;
      --success-color: #27ae60;
      --warning-color: #f39c12;
      --danger-color: #e74c3c;
      --light-bg: #f8f9fa;
      --border-color: #dee2e6;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--light-bg);
      color: var(--primary-color);
    }
    
    .header {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: white;
      padding: 2rem 0;
      margin-bottom: 2rem;
    }
    
    .header h1 {
      font-weight: 300;
      margin-bottom: 0.5rem;
    }
    
    .header .subtitle {
      opacity: 0.9;
      font-size: 1.1rem;
    }
    
    .main-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }
    
    .card {
      border: none;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
      margin-bottom: 1.5rem;
    }
    
    .card-header {
      background: white;
      border-bottom: 2px solid var(--border-color);
      border-radius: 12px 12px 0 0 !important;
      padding: 1.25rem;
    }
    
    .card-header h5 {
      margin: 0;
      color: var(--primary-color);
      font-weight: 600;
    }
    
    .form-label {
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 0.5rem;
    }
    
    .form-control, .form-select {
      border: 2px solid var(--border-color);
      border-radius: 8px;
      padding: 0.75rem;
      transition: all 0.3s ease;
    }
    
    .form-control:focus, .form-select:focus {
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
    }
    
    .btn-primary {
      background: var(--secondary-color);
      border: none;
      border-radius: 8px;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      background: #2980b9;
      transform: translateY(-1px);
    }
    
    .btn-outline-primary {
      border: 2px solid var(--secondary-color);
      color: var(--secondary-color);
      border-radius: 8px;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
    }
    
    .chat-container {
      height: 400px;
      border: 2px solid var(--border-color);
      border-radius: 12px;
      background: white;
      overflow-y: auto;
      padding: 1rem;
    }
    
    .message {
      margin-bottom: 1rem;
      padding: 0.75rem;
      border-radius: 12px;
      max-width: 80%;
    }
    
    .message.user {
      background: var(--secondary-color);
      color: white;
      margin-left: auto;
      text-align: right;
    }
    
    .message.assistant {
      background: #ecf0f1;
      color: var(--primary-color);
      margin-right: auto;
    }
    
    .analysis-report {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      margin-top: 1rem;
    }
    
    .risk-score {
      font-size: 2rem;
      font-weight: bold;
      text-align: center;
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 1rem;
    }
    
    .risk-low { background: #d4edda; color: #155724; }
    .risk-medium { background: #fff3cd; color: #856404; }
    .risk-high { background: #f8d7da; color: #721c24; }
    
    .risk-item, .protection-item {
      background: white;
      border-left: 4px solid var(--secondary-color);
      padding: 1rem;
      margin: 0.75rem 0;
      border-radius: 0 8px 8px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .risk-item.high { border-left-color: var(--danger-color); }
    .risk-item.medium { border-left-color: var(--warning-color); }
    .risk-item.low { border-left-color: var(--success-color); }
    
    .legal-disclaimer {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      padding: 1rem;
      margin: 1.5rem 0;
      text-align: center;
    }
    
    .legal-disclaimer i {
      color: var(--warning-color);
      margin-right: 0.5rem;
    }
    
    .status-message {
      padding: 0.75rem;
      border-radius: 8px;
      margin: 1rem 0;
      font-weight: 500;
    }
    
    .status-loading {
      background: #d1ecf1;
      color: #0c5460;
    }
    
    .status-success {
      background: #d4edda;
      color: #155724;
    }
    
    .status-error {
      background: #f8d7da;
      color: #721c24;
    }
    
    .section-divider {
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--border-color), transparent);
      margin: 2rem 0;
    }
    
    /* Legal Jargon Translator Animations */
    .translation-results {
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.5s ease;
    }
    
    .translation-results.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    .translation-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 4px solid var(--secondary-color);
      opacity: 0;
      transform: translateX(-20px);
      animation: slideInLeft 0.6s ease forwards;
    }
    
    .translation-section:nth-child(2) { animation-delay: 0.1s; }
    .translation-section:nth-child(3) { animation-delay: 0.2s; }
    .translation-section:nth-child(4) { animation-delay: 0.3s; }
    .translation-section:nth-child(5) { animation-delay: 0.4s; }
    
    @keyframes slideInLeft {
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    .translation-term {
      font-size: 1.2rem;
      font-weight: bold;
      color: var(--primary-color);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
    }
    
    .translation-term i {
      margin-right: 0.5rem;
      color: var(--secondary-color);
      animation: bounce 2s infinite;
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-5px); }
      60% { transform: translateY(-3px); }
    }
    
    .quick-term {
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .quick-term:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
    }
    
    .quick-term:active {
      transform: scale(0.95);
    }
    
    .quick-term::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: left 0.5s;
    }
    
    .quick-term:hover::before {
      left: 100%;
    }
    
    #translateBtn {
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    #translateBtn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
    }
    
    #translateBtn.loading {
      pointer-events: none;
    }
    
    #translateBtn.loading i {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .magic-sparkle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: #fff;
      border-radius: 50%;
      animation: sparkle 1.5s ease-in-out infinite;
    }
    
    @keyframes sparkle {
      0%, 100% {
        opacity: 0;
        transform: scale(0);
      }
      50% {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    .translation-section h6 {
      color: var(--secondary-color);
      font-size: 0.9rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.5rem;
    }
    
    .translation-section p {
      margin-bottom: 0;
      line-height: 1.5;
    }
    
    .pulse-effect {
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(52, 152, 219, 0); }
      100% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0); }
    }
    
    /* Chat Loading Animation */
    .generating-response {
      color: #666;
      font-style: italic;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 8px;
      margin: 0.5rem 0;
      border-left: 3px solid var(--primary-color);
    }
    
    .typing-dots {
      display: inline-block;
    }
    
    .typing-dots span {
      display: inline-block;
      animation: typing 1.4s infinite ease-in-out;
      margin-left: 2px;
    }
    
    .typing-dots span:nth-child(1) { animation-delay: 0s; }
    .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
    .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes typing {
      0%, 60%, 100% { 
        opacity: 0.3;
        transform: translateY(0);
      }
      30% { 
        opacity: 1;
        transform: translateY(-5px);
      }
    }
    
    /* Voice Legal Explainer Styles */
    .voice-interface {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      margin-bottom: 1.5rem;
      max-width: 100%;
    }

    .voice-interface .card {
      border: none;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 12px;
    }

    .voice-interface .card-header {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      border: none;
      border-radius: 12px 12px 0 0;
      color: white;
      padding: 1rem 1.25rem;
    }

    .voice-controls {
      padding: 15px 0 10px 0;
    }

    .voice-controls .btn-lg {
      padding: 12px 30px;
      border-radius: 25px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    /* Voice Control Buttons */
    .btn-voice-primary {
      background: #28a745;
      border: 2px solid #28a745;
      color: white;
      font-weight: 500;
      padding: 10px 20px;
      border-radius: 8px;
      transition: all 0.2s ease;
      font-size: 0.95rem;
    }

    .btn-voice-primary:hover {
      background: #218838;
      border-color: #218838;
      color: white;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
    }

    .btn-voice-primary:active {
      background: #1e7e34;
      border-color: #1e7e34;
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(40, 167, 69, 0.3);
      color: white;
    }

    .btn-voice-stop {
      background: #dc3545 !important;
      border: 2px solid #dc3545 !important;
      color: white !important;
      font-weight: 500;
      padding: 10px 20px;
      border-radius: 8px;
      transition: all 0.2s ease;
      font-size: 0.95rem;
    }
    
    .btn-voice-stop:not(:disabled) {
      background: #dc3545 !important;
      border-color: #dc3545 !important;
      color: white !important;
    }

    .btn-voice-stop:hover:not(:disabled) {
      background: #c82333 !important;
      border-color: #c82333 !important;
      color: white !important;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
    }

    .btn-voice-stop:active:not(:disabled) {
      background: #a71e2a !important;
      border-color: #a71e2a !important;
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3);
      color: white !important;
    }

    .btn-voice-stop:focus {
      background: #dc3545 !important;
      border-color: #dc3545 !important;
      color: white !important;
      box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.25);
    }

    .btn-voice-stop:disabled {
      background: #6c757d !important;
      border-color: #6c757d !important;
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .voice-controls .btn:disabled {
      opacity: 0.6;
      transform: none !important;
      box-shadow: none !important;
    }

    .voice-status {
      font-size: 1.1em;
      font-weight: 500;
      padding: 15px;
      border-radius: 10px;
      background: rgba(102, 126, 234, 0.1);
      border: 2px dashed rgba(102, 126, 234, 0.3);
      margin: 15px 0;
    }

    .voice-status.listening {
      background: rgba(220, 53, 69, 0.1);
      border-color: rgba(220, 53, 69, 0.3);
      animation: voicePulse 2s infinite;
    }

    @keyframes voicePulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .voice-transcript {
      background: linear-gradient(135deg, #e3f2fd 0%, #f1f8e9 100%);
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 10px;
      min-height: 80px;
      font-size: 1.1em;
      line-height: 1.6;
      transition: all 0.3s ease;
    }

    .voice-transcript.final-transcript {
      border-color: #28a745;
      background: linear-gradient(135deg, #d4edda 0%, #f8f9fa 100%);
    }

    .voice-explanation {
      animation: voiceSlideIn 0.5s ease-out;
    }

    @keyframes voiceSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .voice-explanation .alert-info {
      background: linear-gradient(135deg, #d1ecf1 0%, #e7f3ff 100%);
      border: 2px solid #17a2b8;
      border-radius: 10px;
    }

    .voice-explanation .btn-outline-primary,
    .voice-explanation .btn-outline-secondary {
      border-radius: 20px;
      padding: 8px 16px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .fa-microphone.text-danger {
      animation: micPulse 1.5s infinite;
    }

    @keyframes micPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }

    /* Clean Markdown formatting */
    .markdown-content h1,
    .markdown-content h2,
    .markdown-content h3 {
      font-weight: 600;
      margin: 1rem 0 0.5rem 0;
      color: var(--primary-color);
    }
    
    .markdown-content h1 { font-size: 1.3rem; }
    .markdown-content h2 { font-size: 1.2rem; }
    .markdown-content h3 { font-size: 1.1rem; }
    
    .markdown-content p {
      margin: 0.5rem 0;
    }
    
    .markdown-content strong {
      font-weight: 600;
      color: #333;
    }
    
    .markdown-content em {
      font-style: italic;
      color: #666;
    }
    
    .markdown-content ul,
    .markdown-content ol {
      margin: 0.5rem 0;
      padding-left: 1.5rem;
    }
    
    .markdown-content li {
      margin: 0.25rem 0;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="main-container">
      <div class="text-center">
        <h1><i class="fas fa-balance-scale me-3"></i>AI Contract Review</h1>
        <p class="subtitle">Professional Legal Document Analysis & Risk Assessment</p>
      </div>
    </div>
  </div>

  <div class="main-container">
    <!-- Legal Disclaimer -->
    <div class="legal-disclaimer">
      <i class="fas fa-exclamation-triangle"></i>
      <strong>Disclaimer: For informational use only. Please consult an attorney for your specific case.</strong>
    </div>

    <div class="row">
      <!-- Left Column: Contract Analysis -->
      <div class="col-lg-8">
        <div class="card">
          <div class="card-header">
            <h5><i class="fas fa-file-contract me-2"></i>Contract Analysis</h5>
          </div>
          <div class="card-body">
            <form id="analyzeForm">
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="contractFile" class="form-label">Contract Document</label>
                    <input type="file" class="form-control" id="contractFile" accept=".pdf,.docx" required>
                    <div class="form-text">Upload PDF or Word document</div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                    <input type="email" class="form-control" id="email" placeholder="your@email.com" required>
                    <div class="form-text">Receive results via email</div>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="jurisdiction" class="form-label">Contract Jurisdiction <span class="text-danger">*</span></label>
                    <select class="form-select" id="jurisdiction" required>
                      <option value="">Select Jurisdiction</option>
                      
                      <!-- U.S. Federal & National Options -->
                      <optgroup label="U.S. Federal & National">
                        <option value="US-Federal">United States – Federal</option>
                        <option value="US-Multistate">Multi-State / Nationwide</option>
                      </optgroup>
                      
                      <!-- U.S. States (Alphabetical) -->
                      <optgroup label="U.S. States">
                        <option value="US-AL">Alabama</option>
                        <option value="US-AK">Alaska</option>
                        <option value="US-AZ">Arizona</option>
                        <option value="US-AR">Arkansas</option>
                        <option value="US-CA">California</option>
                        <option value="US-CO">Colorado</option>
                        <option value="US-CT">Connecticut</option>
                        <option value="US-DE">Delaware</option>
                        <option value="US-FL">Florida</option>
                        <option value="US-GA">Georgia</option>
                        <option value="US-HI">Hawaii</option>
                        <option value="US-ID">Idaho</option>
                        <option value="US-IL">Illinois</option>
                        <option value="US-IN">Indiana</option>
                        <option value="US-IA">Iowa</option>
                        <option value="US-KS">Kansas</option>
                        <option value="US-KY">Kentucky</option>
                        <option value="US-LA">Louisiana</option>
                        <option value="US-ME">Maine</option>
                        <option value="US-MD">Maryland</option>
                        <option value="US-MA">Massachusetts</option>
                        <option value="US-MI">Michigan</option>
                        <option value="US-MN">Minnesota</option>
                        <option value="US-MS">Mississippi</option>
                        <option value="US-MO">Missouri</option>
                        <option value="US-MT">Montana</option>
                        <option value="US-NE">Nebraska</option>
                        <option value="US-NV">Nevada</option>
                        <option value="US-NH">New Hampshire</option>
                        <option value="US-NJ">New Jersey</option>
                        <option value="US-NM">New Mexico</option>
                        <option value="US-NY">New York</option>
                        <option value="US-NC">North Carolina</option>
                        <option value="US-ND">North Dakota</option>
                        <option value="US-OH">Ohio</option>
                        <option value="US-OK">Oklahoma</option>
                        <option value="US-OR">Oregon</option>
                        <option value="US-PA">Pennsylvania</option>
                        <option value="US-RI">Rhode Island</option>
                        <option value="US-SC">South Carolina</option>
                        <option value="US-SD">South Dakota</option>
                        <option value="US-TN">Tennessee</option>
                        <option value="US-TX">Texas</option>
                        <option value="US-UT">Utah</option>
                        <option value="US-VT">Vermont</option>
                        <option value="US-VA">Virginia</option>
                        <option value="US-WA">Washington</option>
                        <option value="US-WV">West Virginia</option>
                        <option value="US-WI">Wisconsin</option>
                        <option value="US-WY">Wyoming</option>
                      </optgroup>
                      
                      <!-- International Options -->
                      <optgroup label="International">
                        <option value="CA">Canada</option>
                        <option value="UK">United Kingdom</option>
                        <option value="EU">European Union</option>
                        <option value="AU">Australia</option>
                        <option value="IN">India</option>
                        <option value="Other">Other (Enter Manually)</option>
                      </optgroup>
                    </select>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="contractType" class="form-label">Contract Type <span class="text-danger">*</span></label>
                    <select class="form-select" id="contractType" required>
                      <option value="">Select Contract Type</option>
                      <option value="NDA">Non-Disclosure Agreement</option>
                      <option value="MSA">Master Service Agreement</option>
                      <option value="SaaS">SaaS Terms of Service</option>
                      <option value="Employment">Employment Agreement</option>
                      <option value="Consulting">Consulting Agreement</option>
                      <option value="License">License Agreement</option>
                      <option value="Purchase">Purchase Agreement</option>
                      <option value="Lease">Lease Agreement</option>
                      <option value="Partnership">Partnership Agreement</option>
                      <option value="Vendor">Vendor Agreement</option>
                      <option value="Other">Other</option>
                    </select>
                  </div>
                </div>
              </div>
              
              <!-- Other Contract Type Input (hidden by default) -->
              <div class="row" id="otherContractTypeRow" style="display: none;">
                <div class="col-12">
                  <div class="mb-3">
                    <label for="otherContractType" class="form-label">Enter custom contract type</label>
                    <input type="text" class="form-control" id="otherContractType" 
                           placeholder="Please specify the contract type">
                  </div>
                </div>
              </div>
              
              <!-- Custom Jurisdiction Input (hidden by default) -->
              <div class="row" id="customJurisdictionRow" style="display: none;">
                <div class="col-12">
                  <div class="mb-3">
                    <label for="customJurisdiction" class="form-label">Enter custom jurisdiction</label>
                    <input type="text" class="form-control" id="customJurisdiction" 
                           placeholder="Please specify the jurisdiction">
                  </div>
                </div>
              </div>

              <button type="submit" class="btn btn-primary w-100">
                <i class="fas fa-search me-2"></i>Analyze Contract
              </button>
            </form>

            <div id="analyzeStatus"></div>
            <div id="analysisReport"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Voice Legal Assistant -->
    <div class="row">
      <div class="col-lg-8">
        <div id="voice-legal-interface" class="voice-interface mb-4">
          <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0" style="color: white; font-weight: 600;">
            <i class="fas fa-microphone me-2" style="color: #ffc107;"></i>
            Voice Legal Assistant
          </h5>
          <small style="color: rgba(255,255,255,0.9); font-weight: 500;">Ask about legal terms using your voice</small>
        </div>
        <div class="card-body" style="padding: 1rem 1.25rem;">
          <div class="voice-controls text-center mb-2">
            <button id="startVoiceBtn" class="btn btn-voice-primary me-3">
              <i class="fas fa-microphone me-2"></i>
              Start Listening
            </button>
            <button id="stopVoiceBtn" class="btn btn-voice-stop" disabled>
              <i class="fas fa-stop me-2"></i>
              Stop
            </button>
          </div>
          
          <div id="voiceStatus" class="voice-status text-center mb-3">
            <span class="text-muted">Click "Start Listening" to ask about legal terms</span>
          </div>
          
          <div id="voiceTranscript" class="voice-transcript p-3 bg-light rounded" style="min-height: 60px; display: none;">
            <strong>You said:</strong> <span id="transcriptText"></span>
          </div>
          
          <div id="voiceExplanation" class="voice-explanation mt-3" style="display: none;">
            <div class="alert alert-info">
              <h6><i class="fas fa-lightbulb me-2"></i>Legal Explanation:</h6>
              <div id="explanationText"></div>
              <div class="mt-2">
                <button id="speakExplanationBtn" class="btn btn-sm btn-outline-primary me-2">
                  <i class="fas fa-volume-up"></i> Listen to Explanation
                </button>
                <button id="askAnotherBtn" class="btn btn-sm btn-outline-secondary">
                  <i class="fas fa-microphone"></i> Ask Another Term
                </button>
              </div>
            </div>
          </div>
          
          <div class="voice-examples mt-3">
            <small class="text-muted">
              <strong>Try saying:</strong> "What does force majeure mean?" • "Explain liquidated damages" • "What is indemnification?"
            </small>
          </div>
        </div>
        </div>
      </div>
      <div class="col-lg-4">
        <!-- Spacer to align with contract analysis layout -->
      </div>
    </div>

    <div class="row">
      <!-- Right Column: Chat Assistant & Legal Jargon Translator -->
      <div class="col-lg-4">
        <!-- Legal Jargon Translator -->
        <div class="card mb-3">
          <div class="card-header">
            <h5><i class="fas fa-language me-2"></i>Legal Jargon Translator</h5>
          </div>
          <div class="card-body p-0">
            <div id="jargonTranslator">
              <div class="p-3">
                <div class="mb-3">
                  <input type="text" class="form-control" id="legalTermInput" placeholder="Enter legal term or phrase..." maxlength="200">
                  <div class="form-text">e.g., "force majeure", "indemnification", "consideration"</div>
                </div>
                
                <!-- Quick Examples -->
                <div class="mb-3">
                  <div class="d-flex flex-wrap gap-2">
                    <button type="button" class="btn btn-outline-primary btn-sm quick-term" data-term="force majeure">Force Majeure</button>
                    <button type="button" class="btn btn-outline-primary btn-sm quick-term" data-term="indemnification">Indemnification</button>
                    <button type="button" class="btn btn-outline-primary btn-sm quick-term" data-term="liquidated damages">Liquidated Damages</button>
                    <button type="button" class="btn btn-outline-primary btn-sm quick-term" data-term="consideration">Consideration</button>
                  </div>
                </div>
                
                <button type="button" class="btn btn-primary w-100" id="translateBtn">
                  <i class="fas fa-magic me-2"></i>Translate to Plain English
                </button>
              </div>
              
              <!-- Translation Results -->
              <div id="translationResults" class="translation-results" style="display: none;">
                <div class="p-3 border-top">
                  <div class="translation-content">
                    <!-- Dynamic content will be inserted here -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Chat Assistant -->
        <div class="card">
          <div class="card-header">
            <h5><i class="fas fa-robot me-2"></i>Contract Assistant</h5>
          </div>
          <div class="card-body p-0">
            <div class="chat-container" id="chatContainer">
              <div class="message assistant">
                <strong>AI Assistant:</strong> Hello! Welcome to our AI Contract Review service! I'm here to help you with contract analysis, legal guidance, and risk assessment. You can ask me questions about contract terms, risks, or legal concepts before, during, or after uploading your document. How can I assist you today?
              </div>
            </div>
            <div class="p-3 border-top">
              <form id="chatForm">
                <div class="input-group">
                  <input type="text" class="form-control" id="userQuestion" 
                         placeholder="Ask about contract terms, risks, or legal concepts..." required>
                  <button class="btn btn-outline-primary" type="submit">
                    <i class="fas fa-paper-plane"></i>
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    const analyzeForm = document.getElementById('analyzeForm');
    const contractFile = document.getElementById('contractFile');
    const email = document.getElementById('email');
    const jurisdiction = document.getElementById('jurisdiction');
    const contractType = document.getElementById('contractType');
    const analyzeStatus = document.getElementById('analyzeStatus');
    const analysisReport = document.getElementById('analysisReport');
    
    const chatForm = document.getElementById('chatForm');
    const userQuestion = document.getElementById('userQuestion');
    const chatContainer = document.getElementById('chatContainer');
    
    // Track chat interactions and document upload status
    let chatCount = 0;
    let documentUploaded = false;

    // Contract Analysis
    analyzeForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const file = contractFile.files[0];
      if (!file) return;

      // Validate required fields
      if (!email.value.trim()) {
        showStatus('Please enter your email address.', 'error');
        return;
      }
      if (!jurisdiction.value) {
        showStatus('Please select or enter a contract jurisdiction.', 'error');
        return;
      }
      if (jurisdiction.value === 'Other' && !document.getElementById('customJurisdiction').value.trim()) {
        showStatus('Please specify the custom jurisdiction when selecting "Other".', 'error');
        return;
      }
      if (!contractType.value) {
        showStatus('Please select a contract type.', 'error');
        return;
      }
      if (contractType.value === 'Other' && !document.getElementById('otherContractType').value.trim()) {
        showStatus('Please specify the contract type when selecting "Other".', 'error');
        return;
      }

      const formData = new FormData();
      formData.append('file', file);
      formData.append('jurisdiction', jurisdiction.value); // Jurisdiction is now required
      formData.append('contract_type', contractType.value); // Contract type is now required
      formData.append('email', email.value); // Email is now required
      
      // Add custom jurisdiction if specified
      if (jurisdiction.value === 'Other') {
        formData.append('customJurisdiction', document.getElementById('customJurisdiction').value.trim());
      }
      
      // Add other contract type if specified
      if (contractType.value === 'Other') {
        formData.append('customContractType', document.getElementById('otherContractType').value.trim());
      }

      showStatus('Analyzing your contract... This may take a few minutes.', 'loading');
      analysisReport.innerHTML = '';

      try {
        const response = await fetch('/analyze', {
          method: 'POST',
          body: formData
        });
        
        const result = await response.json();
        
        if (result.error) {
          showStatus(result.error, 'error');
          return;
        }

        showStatus('Analysis completed successfully!', 'success');
        displayAnalysisReport(result);
        
        // Mark document as uploaded
        documentUploaded = true;
        
        // Add analysis completion message to chat
        addChatMessage('assistant', 'Your contract analysis is complete! I can now answer specific questions about your contract. What would you like to know?');
        
      } catch (error) {
        console.error('Analysis error:', error);
        showStatus('Analysis failed. Please try again.', 'error');
      }
    });

    // Chat functionality
    chatForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const question = userQuestion.value.trim();
      if (!question) return;

      addChatMessage('user', question);
      userQuestion.value = '';

      // Add generating response animation
      const loadingMessage = addGeneratingResponse();

      try {
        const formData = new FormData();
        formData.append('query', question);
        if (jurisdiction.value) formData.append('jurisdiction', jurisdiction.value);
        if (contractType.value) formData.append('contract_type', contractType.value);

        // Use simple chat endpoint
        const response = await fetch('/chat', {
          method: 'POST',
          body: formData
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();
        console.log('Chat result:', result);
        
        // Remove loading message
        removeGeneratingResponse(loadingMessage);
        
        if (result.response) {
          addChatMessage('assistant', result.response);
          
          // Increment chat count and check for upload reminder
          chatCount++;
          if (chatCount % 2 === 0 && !documentUploaded) {
            // Add gentle reminder after every 2 chats if no document uploaded
            setTimeout(() => {
              addChatMessage('assistant', '💡 <em>Tip: For more personalized contract analysis, consider uploading your contract document above. I can provide specific insights about your contract\'s terms, risks, and recommendations!</em>');
            }, 1000);
          }
        } else {
          addChatMessage('assistant', 'I apologize, but I encountered an error processing your question. Please try again.');
        }
        
      } catch (error) {
        // Remove loading message on error
        removeGeneratingResponse(loadingMessage);
        
        console.error('Chat error:', error);
        console.error('Chat error details:', error.message);
        addChatMessage('assistant', 'I apologize, but I encountered an error processing your question. Please try again.');
      }
    });

    function showStatus(message, type) {
      analyzeStatus.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
    }

    // Legal Jargon Translator functionality
    const legalTermInput = document.getElementById('legalTermInput');
    const translateBtn = document.getElementById('translateBtn');
    const translationResults = document.getElementById('translationResults');
    const quickTermButtons = document.querySelectorAll('.quick-term');
    
    // Quick term button handlers
    quickTermButtons.forEach(button => {
      button.addEventListener('click', () => {
        const term = button.dataset.term;
        legalTermInput.value = term;
        button.classList.add('pulse-effect');
        setTimeout(() => button.classList.remove('pulse-effect'), 1000);
      });
    });
    
    // Translate button handler
    translateBtn.addEventListener('click', async () => {
      const term = legalTermInput.value.trim();
      if (!term) {
        legalTermInput.focus();
        legalTermInput.classList.add('pulse-effect');
        setTimeout(() => legalTermInput.classList.remove('pulse-effect'), 1000);
        return;
      }
      
      // Add loading state
      translateBtn.classList.add('loading');
      translateBtn.innerHTML = '<i class="fas fa-magic me-2"></i>Translating...';
      
      // Create sparkle effect
      createSparkleEffect(translateBtn);
      
      // Hide previous results
      translationResults.classList.remove('show');
      
      try {
        const formData = new FormData();
        formData.append('legal_term', term);
        
        // Get contract type context safely
        const contractTypeElement = document.getElementById('contractType');
        const context = contractTypeElement ? contractTypeElement.value : '';
        formData.append('context', context);
        
        const response = await fetch('/translate_jargon', {
          method: 'POST',
          body: formData
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        console.log('Translation result:', result);
        
        if (result.status === 'success') {
          displayTranslation(result.term, result.translation);
        } else {
          showTranslationError(result.error || 'Translation failed');
        }
        
      } catch (error) {
        console.error('Translation error:', error);
        console.error('Error details:', error.message);
        showTranslationError('Failed to translate term. Please try again.');
      } finally {
        // Remove loading state
        translateBtn.classList.remove('loading');
        translateBtn.innerHTML = '<i class="fas fa-magic me-2"></i>Translate to Plain English';
      }
    });
    
    // Enter key handler for input
    legalTermInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        translateBtn.click();
      }
    });
    
    function createSparkleEffect(element) {
      for (let i = 0; i < 6; i++) {
        setTimeout(() => {
          const sparkle = document.createElement('div');
          sparkle.className = 'magic-sparkle';
          sparkle.style.left = Math.random() * element.offsetWidth + 'px';
          sparkle.style.top = Math.random() * element.offsetHeight + 'px';
          element.appendChild(sparkle);
          
          setTimeout(() => sparkle.remove(), 1500);
        }, i * 100);
      }
    }
    
    function displayTranslation(term, translation) {
      const content = `
        <div class="translation-term">
          <i class="fas fa-lightbulb"></i>
          "${term}"
        </div>
        
        <div class="translation-section">
          <h6>Simple Definition</h6>
          <p>${translation.simple_definition}</p>
        </div>
        
        <div class="translation-section">
          <h6>Detailed Explanation</h6>
          <p>${translation.detailed_explanation}</p>
        </div>
        
        <div class="translation-section">
          <h6>Real-World Example</h6>
          <p>${translation.real_world_example}</p>
        </div>
        
        <div class="translation-section">
          <h6>Why It Matters</h6>
          <p>${translation.why_it_matters}</p>
        </div>
        
        <div class="translation-section">
          <h6>Common Usage</h6>
          <p>${translation.common_usage}</p>
        </div>
      `;
      
      translationResults.querySelector('.translation-content').innerHTML = content;
      translationResults.style.display = 'block';
      
      // Trigger show animation
      setTimeout(() => {
        translationResults.classList.add('show');
      }, 50);
    }
    
    function showTranslationError(message) {
      const content = `
        <div class="translation-section" style="border-left-color: var(--danger-color);">
          <h6>Translation Error</h6>
          <p>${message}</p>
        </div>
      `;
      
      translationResults.querySelector('.translation-content').innerHTML = content;
      translationResults.style.display = 'block';
      translationResults.classList.add('show');
    }

    function addChatMessage(sender, message) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}`;
      
      if (sender === 'assistant') {
        // Clean and parse Markdown for assistant responses
        const cleanedMessage = cleanMarkdown(message);
        const formattedMessage = marked.parse(cleanedMessage);
        messageDiv.innerHTML = `<strong>AI Assistant:</strong><br><div class="markdown-content">${formattedMessage}</div>`;
      } else {
        messageDiv.innerHTML = `<strong>You:</strong> ${message}`;
      }
      
      chatContainer.appendChild(messageDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }
    
    function cleanMarkdown(text) {
      // Clean up any irregular formatting before parsing
      return text
        .replace(/\*\*\*(.+?)\*\*\*/g, '**$1**') // Convert triple stars to double
        .replace(/\*\*([^*]+)\*\*(?!\w)/g, '**$1**') // Ensure proper bold formatting
        .replace(/\n\s*\n/g, '\n\n') // Clean up spacing
        .trim();
    }

    // Removed formatAssistantMessage - now using marked.parse for Markdown rendering
    
    function addGeneratingResponse() {
      const loadingDiv = document.createElement('div');
      loadingDiv.className = 'message assistant generating-response';
      loadingDiv.innerHTML = `
        <strong>AI Assistant:</strong><br>
        <span style="color: #666;">Generating response</span>
        <span class="typing-dots">
          <span>.</span>
          <span>.</span>
          <span>.</span>
        </span>
      `;
      chatContainer.appendChild(loadingDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
      return loadingDiv;
    }
    
    function removeGeneratingResponse(loadingElement) {
      if (loadingElement && loadingElement.parentNode) {
        loadingElement.parentNode.removeChild(loadingElement);
      }
    }

    function displayAnalysisReport(analysis) {
      const riskScore = analysis.risk_score || analysis.overall_risk_score || 0;
      const riskLevel = riskScore >= 7 ? 'high' : riskScore >= 4 ? 'medium' : 'low';
      
      let html = `
        <div class="analysis-report">
          <div class="risk-score risk-${riskLevel}">
            <div>Overall Risk Score</div>
            <div>${riskScore}/10</div>
          </div>
          
          <div class="mb-4">
            <h6><i class="fas fa-clipboard-list me-2"></i>Executive Summary</h6>
            <p class="mb-0">${analysis.summary}</p>
          </div>
      `;

      if (analysis.risky_clauses && analysis.risky_clauses.length > 0) {
        html += `
          <div class="mb-4">
            <h6><i class="fas fa-exclamation-triangle me-2"></i>Risk Analysis (${analysis.risky_clauses.length} items)</h6>
        `;
        
        analysis.risky_clauses.forEach(clause => {
          const level = clause.risk_level ? clause.risk_level.toLowerCase() : 'medium';
          html += `
            <div class="risk-item ${level}">
              <div class="fw-bold">${clause.clause_type}</div>
              <div class="mb-2">${clause.description}</div>
              <div class="text-muted"><i class="fas fa-lightbulb me-1"></i>${clause.recommendation}</div>
            </div>
          `;
        });
        html += '</div>';
      }

      if (analysis.missing_protections && analysis.missing_protections.length > 0) {
        html += `
          <div class="mb-4">
            <h6><i class="fas fa-shield-alt me-2"></i>Missing Protections (${analysis.missing_protections.length} items)</h6>
        `;
        
        analysis.missing_protections.forEach(protection => {
          html += `
            <div class="protection-item">
              <div class="fw-bold">${protection.protection_type}</div>
              <div class="mb-2">${protection.description}</div>
              <div class="text-muted mb-2"><strong>Importance:</strong> ${protection.importance}</div>
              <div class="text-muted"><i class="fas fa-plus-circle me-1"></i><strong>Suggested:</strong> ${protection.suggested_clause}</div>
            </div>
          `;
        });
        html += '</div>';
      }

      if (analysis.detailed_analysis) {
        html += `
          <div class="mb-4">
            <h6><i class="fas fa-search me-2"></i>Detailed Analysis</h6>
            <p class="mb-0">${analysis.detailed_analysis}</p>
          </div>
        `;
      }

      html += '</div>';
      analysisReport.innerHTML = html;
    }
    
    // Handle "Other" contract type selection
    if (contractType) {
      contractType.addEventListener('change', function() {
        const otherRow = document.getElementById('otherContractTypeRow');
        const otherInput = document.getElementById('otherContractType');
        
        console.log('Contract type changed to:', this.value); // Debug log
        
        if (this.value === 'Other') {
          if (otherRow) {
            otherRow.style.display = 'block';
          }
          if (otherInput) {
            otherInput.required = true;
            otherInput.focus(); // Focus the input for better UX
          }
        } else {
          if (otherRow) {
            otherRow.style.display = 'none';
          }
          if (otherInput) {
            otherInput.required = false;
            otherInput.value = '';
          }
        }
      });
    } else {
      console.error('Contract type element not found');
    }
    
    // Handle "Other" jurisdiction selection
    if (jurisdiction) {
      jurisdiction.addEventListener('change', function() {
        const customJurisdictionRow = document.getElementById('customJurisdictionRow');
        const customJurisdictionInput = document.getElementById('customJurisdiction');
        
        console.log('Jurisdiction changed to:', this.value); // Debug log
        
        if (this.value === 'Other') {
          if (customJurisdictionRow) {
            customJurisdictionRow.style.display = 'block';
          }
          if (customJurisdictionInput) {
            customJurisdictionInput.required = true;
            customJurisdictionInput.focus(); // Focus the input for better UX
          }
        } else {
          if (customJurisdictionRow) {
            customJurisdictionRow.style.display = 'none';
          }
          if (customJurisdictionInput) {
            customJurisdictionInput.required = false;
            customJurisdictionInput.value = '';
          }
        }
      });
    } else {
      console.error('Jurisdiction element not found');
    }

  </script>
  <script src="/static/js/voice-legal.js"></script>
</body>
</html>